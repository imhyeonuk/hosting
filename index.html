<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=t0xghbfgfz"></script>
    <style>
        #map { height: 400px; }
    </style>
</head>
<body>
<button id="startDrawing">그림 그리기 시작</button>
<button id="stopDrawing" style="display:none;">그림 그리기 종료</button>
<button id="undoDrawing" style="display:none;">되돌리기</button> <!-- 되돌리기 버튼 추가 -->
<div id="map"></div>
<script>
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
        var lat = position.coords.latitude,
            lon = position.coords.longitude;
        var mapOptions = {
            center: new naver.maps.LatLng(lat, lon),
            zoom: 17
        };
        var map = new naver.maps.Map('map', mapOptions);
        
        var marker = new naver.maps.Marker({
            position: new naver.maps.LatLng(lat, lon),
            map: map,
            icon: {
                content: '<div style="width:10px; height:10px; background-color:black; border-radius:50%;"></div>',
                anchor: new naver.maps.Point(5, 5)
            }
        });

        var drawing = false;
        var path = [];
        var polyline = new naver.maps.Polyline({
            map: map,
            path: [],
            strokeColor: '#5347AA',
            strokeWeight: 3
        });

        document.getElementById('startDrawing').addEventListener('click', function() {
            drawing = true;
            this.style.display = 'none';
            document.getElementById('stopDrawing').style.display = 'inline';
            document.getElementById('undoDrawing').style.display = 'inline'; // 되돌리기 버튼 표시
            map.setCursor('crosshair');
        });

        document.getElementById('stopDrawing').addEventListener('click', function() {
            drawing = false;
            document.getElementById('startDrawing').style.display = 'inline';
            this.style.display = 'none';
            document.getElementById('undoDrawing').style.display = 'none'; // 되돌리기 버튼 숨김
            map.setCursor('');
        });

        // 되돌리기 버튼 이벤트 핸들러
        document.getElementById('undoDrawing').addEventListener('click', function() {
            if (path.length > 0) {
                path.pop(); // 마지막 경로 제거
                polyline.setPath(path); // 폴리라인 업데이트
            }
        });

        // 지도 위를 클릭하여 좌표를 콘솔에 출력하고 경로에 추가하는 이벤트 핸들러
        naver.maps.Event.addListener(map, 'click', function(e) {
            if (!drawing) return; // 그리기 모드가 활성화되어 있지 않으면 리턴
            console.log(`위도: ${e.coord.lat()}, 경도: ${e.coord.lng()}`); // 클릭된 위치의 좌표를 콘솔에 출력
            path.push(e.coord); // 경로에 클릭 위치 추가
            polyline.setPath(path); // 폴리라인 업데이트
        });
    }, function(err) {
        console.warn(`ERROR(${err.code}): ${err.message}`);
    }, {
        maximumAge:60000,
        timeout:5000,
        enableHighAccuracy: true
    });
} else {
    alert("이 브라우저에서는 Geolocation이 지원되지 않습니다.");
}
</script>
</body>
</html>
