<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Kakao 지도 시작하기</title>
</head>
<body>
    <div id="map" style="width:500px;height:400px;"></div>
    <button id="toggleBtn">시작하기</button>
    <label for="lineColorPicker">선 색상 선택:</label>
    <input type="color" id="lineColorPicker" name="lineColor" value="#FFAE00"> <!-- 선 색상 선택기 -->
    <label for="dotColorPicker">점 색상 선택:</label>
    <input type="color" id="dotColorPicker" name="dotColor" value="#FF5757"> <!-- 점 색상 선택기 추가 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e17b255a81f15150d802f2e57887f807
    "></script>
    <script>
        var container = document.getElementById('map');
        var options = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 3
        };

        var map = new kakao.maps.Map(container, options);
        var polylinePath = [];
        var selectedLineColor = '#FFAE00'; // 초기 선 색상 값
        var selectedDotColor = '#FF5757'; // 초기 점 색상 값

        var polyline = new kakao.maps.Polyline({
            map: map,
            path: polylinePath,
            strokeWeight: 5,
            strokeColor: selectedLineColor, // 선 색상 동적으로 지정
            strokeOpacity: 0.7,
            strokeStyle: 'solid'
        });

        var locationDot = null;

        function displayCurrentLocation(position) {
            var lat = position.coords.latitude,
                lon = position.coords.longitude;
            var locPosition = new kakao.maps.LatLng(lat, lon);

            if (!locationDot) {
                var dotContent = '<div class="location-dot" style="background-color: ' + selectedDotColor + '"></div>'; // 점 색상 동적으로 지정
                locationDot = new kakao.maps.CustomOverlay({
                    map: map,
                    position: locPosition,
                    content: dotContent,
                    yAnchor: 1 
                });
            } else {
                locationDot.setPosition(locPosition);
                document.querySelector('.location-dot').style.backgroundColor = selectedDotColor; // 점 색상 업데이트
            }

            map.setCenter(locPosition);

            if (isTracking) {
                polylinePath.push(locPosition);
                polyline.setPath(polylinePath);
            }
        }

        var isTracking = false;
        var watchId;

        document.getElementById('toggleBtn').addEventListener('click', function() {
    if (!isTracking) {
        this.textContent = '종료하기';
        polylinePath = []; // 경로를 새로 시작하려면 이전 경로를 초기화
        isTracking = true; // 추적 시작

        // 선택된 색상으로 polyline 선 색상 설정
        selectedLineColor = document.getElementById('lineColorPicker').value;
        polyline.setStrokeColor(selectedLineColor);
        polyline.setMap(map); // 지도에 polyline을 다시 추가하여 변경사항을 적용

    } else {
        this.textContent = '시작하기';
        isTracking = false; // 추적 중지
        // 필요한 경우, 추적 중지시 추가적인 처리를 여기에 추가할 수 있습니다.
    }
});


        document.getElementById('lineColorPicker').addEventListener('change', function() {
            selectedLineColor = this.value;
            polyline.setStrokeColor(selectedLineColor); // 사용자가 선택한 색상으로 선 색상 업데이트
        });

        document.getElementById('dotColorPicker').addEventListener('change', function() {
            selectedDotColor = this.value; // 사용자가 선택한 색상으로 점 색상 업데이트
            if(locationDot) {
                var dotContent = '<div class="location-dot" style="background-color: ' + selectedDotColor + '"></div>'; // 점 색상 업데이트
                locationDot.setContent(dotContent);
            }
        });

        if (navigator.geolocation) {
            watchId = navigator.geolocation.watchPosition(displayCurrentLocation, handleError, {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            });
        } else {
            alert("Geolocation is not supported by this browser.");
        }

        function handleError(error) {
            console.warn(`ERROR(${error.code}): ${error.message}`);
        }
    </script>
    <style>
        .location-dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            position: absolute;
            top: -4px;
            left: -4px;
        }
    </style>
</body>
</html>
